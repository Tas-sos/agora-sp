from django.test import TestCase, Client
from django.test.client import RequestFactory
from common import helper, strings
import json

# Create your tests here.


class ServiceTestCase(TestCase):

    fixtures = ["test.json"]

    def setUp(self):
        self.factory = RequestFactory()
        self.client_stub = Client()
        self.maxDiff = None

    def test_invalid_url(self):
        response = self.client_stub.get('/')

        expected_response = helper.page_not_found()

        self.assertJSONEqual(json.dumps(expected_response), response.content)
        response = self.client_stub.get("/ved/defea")
        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_get_service_invalid_name(self):
        response = self.client_stub.get('/api/v1/portfolio/services/B2SAFISH')

        expected_response = helper.get_error_response(strings.SERVICE_NOT_FOUND)

        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_get_service_invalid_uuid(self):
        response = self.client_stub.get('/api/v1/portfolio/services/583ec8f2-9ef6-4e51-89bd-9af7f5fcea9r')

        expected_response = helper.get_error_response(strings.SERVICE_NOT_FOUND)

        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_get_service_nonexistent_uuid(self):
        response = self.client_stub.get('/api/v1/portfolio/services/583ec8f2-9ef6-4e51-89bd-9af7f5fcea9d')

        expected_response = helper.get_error_response(strings.SERVICE_NOT_FOUND)

        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_get_service_invalid_query_parameter(self):
        response = self.client_stub.get('/api/v1/portfolio/services/583ec8f2-9ef6-4e51-89bd-9af7f5fcea9c?view=full')

        expected_response = helper.get_error_response(strings.INVALID_QUERY_PARAMETER)

        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_get_service(self):
        response_name = self.client_stub.get('/api/v1/portfolio/services/B2SAFE')
        response_uuid = self.client_stub.get('/api/v1/portfolio/services/88b35b0d-adc2-4a2e-b5fc-cae2d6f5456a')

        data = {"funders_for_service": "/", "contact_information_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/contact_information", "meta": {"desc": "Link contact information about this service"}}}, "value_to_customer": "Data replication  and safe storage  of your community data between geographically distributed centres", "user_customers_list": {"count": 0, "user_customers": []}, "description_internal": "\"B2SAFE is a robust, safe and highly available service which allows community and departmental repositories to implement data management policies on their research data across multiple administrative domains in a trustworthy manner.  \r\nabstraction layer of large scale, heterogeneous data storages\r\nguards against data loss in long-term archiving\r\nallows to optimize access for users (e.g. from different regions)\r\nbrings data closer to facilities for compute-intensive analysis\r\n\"", "request_procedures": "Joining the EUDAT CDI", "service_owner_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_owner", "meta": {"desc": "Service owner link"}}}, "name": "B2SAFE", "uuid": "88b35b0d-adc2-4a2e-b5fc-cae2d6f5456a", "service_details_list": {"count": 2, "service_details": [{"accounting_link": {"related": {"href": "", "meta": {"desc": "A link to the accounting system for this service."}}}, "version": "3.2", "monitoring_has": False, "service_status": "a", "features_current": "s", "decommissioning_procedure_has": False, "cost_to_run": "4", "operations_documentation_link": {"related": {"href": "", "meta": {"desc": "A link to the operations documentation for this service."}}}, "user_documentation_link": {"related": {"href": "", "meta": {"desc": "A link to the user documentation for this service."}}}, "service_details_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_details/3.2", "meta": {"desc": "Service details link"}}}, "accounting_has": False, "business_continuity_plan_link": {"related": {"href": "", "meta": {"desc": "A link to the business continuity plan for this service."}}}, "usage_policy_link": {"related": {"href": "", "meta": {"desc": "A link to the usage policy for this service."}}}, "operations_documentation_has": False, "monitoring_link": {"related": {"href": "", "meta": {"desc": "A link to the monitoring system for this service."}}}, "business_continuity_plan_has": False, "disaster_recovery_plan_url": {"related": {"href": "", "meta": {"desc": "A link to the disaster recovery plan for this service."}}}, "cost_to_build": "3", "use_cases": "d", "dependencies": {"count": 1, "services": [{"service_link": {"meta": {"desc": "A list of service dependencies"}, "related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2HANDLE"}}, "uuid": "9985c4ee-bef1-46d5-ae00-e501bfa7bdd0", "name": "B2HANDLE"}], "service_dependencies_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_dependencies", "meta": {"desc": "A list of links to the service dependencies"}}}}, "disaster_recovery_plan_has": False, "uuid": "80557cf5-cdb9-4dc5-b9d3-993008e054e3", "features_future": "s", "usage_policy_has": False, "user_documentation_has": False, "decommissioning_procedure_url": {"related": {"href": "", "meta": {"desc": "A link to the decommissioning procedure for this service."}}}}, {"accounting_link": {"related": {"href": "/", "meta": {"desc": "A link to the accounting system for this service."}}}, "version": "3.0", "monitoring_has": True, "service_status": "Active", "features_current": "\"Features:     - based on the execution of auditable data policy rules and the use of persistent identifiers (PIDs)    -  respects the rights of the data owners to define the access rights for their data and to decide how and when it is made publicly refe", "decommissioning_procedure_has": False, "cost_to_run": "Not specified", "operations_documentation_link": {"related": {"href": "", "meta": {"desc": "A link to the operations documentation for this service."}}}, "user_documentation_link": {"related": {"href": "http://eudat.eu/services/userdoc/configure-b2safe", "meta": {"desc": "A link to the user documentation for this service."}}}, "service_details_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_details/3.0", "meta": {"desc": "Service details link"}}}, "accounting_has": False, "business_continuity_plan_link": {"related": {"href": "/", "meta": {"desc": "A link to the business continuity plan for this service."}}}, "usage_policy_link": {"related": {"href": "/", "meta": {"desc": "A link to the usage policy for this service."}}}, "operations_documentation_has": False, "monitoring_link": {"related": {"href": "https://cmon.eudat.eu/nagvis_in_a_box.html", "meta": {"desc": "A link to the monitoring system for this service."}}}, "business_continuity_plan_has": False, "disaster_recovery_plan_url": {"related": {"href": "/", "meta": {"desc": "A link to the disaster recovery plan for this service."}}}, "cost_to_build": "Not specified", "use_cases": "", "dependencies": {"count": 1, "services": [{"service_link": {"meta": {"desc": "A list of service dependencies"}, "related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2HANDLE"}}, "uuid": "9985c4ee-bef1-46d5-ae00-e501bfa7bdd0", "name": "B2HANDLE"}], "service_dependencies_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_dependencies", "meta": {"desc": "A list of links to the service dependencies"}}}}, "disaster_recovery_plan_has": False, "uuid": "aa37cd70-c3e3-4334-a719-d467c22aed81", "features_future": "Futurs Features:                                                                                                                          - data policies are centrally managed via a Data Policy Manager, and the policy rules are implemented and enforced by", "usage_policy_has": False, "user_documentation_has": True, "decommissioning_procedure_url": {"related": {"href": "/", "meta": {"desc": "A link to the decommissioning procedure for this service."}}}}]}, "description_external": "\"B2SAFE is a robust, safe and highly available service which allows community and departmental repositories to implement data management policies on their research data across multiple administrative domains in a trustworthy manner.  \nabstraction layer of large scale, heterogeneous data storages\nguards against data loss in long-term archiving\nallows to optimize access for users (e.g. from different regions)\nbrings data closer to facilities for compute-intensive analysis\n\"", "service_area": "Data hosting & management", "service_complete_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE?view=complete", "meta": {"desc": "Portfolio level details about this service."}}}, "competitors": "/", "risks": "/"}
        expected_response = helper.get_response_info(strings.SERVICE_INFORMATION, data)

        self.assertJSONEqual(json.dumps(expected_response), response_name.content)
        self.assertJSONEqual(json.dumps(expected_response), response_uuid.content)

    def test_get_service_query_parameter(self):
        response_short = self.client_stub.get('/api/v1/portfolio/services/B2SAFE?view=short')
        response_complete = self.client_stub.get('/api/v1/portfolio/services/B2SAFE?view=complete')

        data_short = {"funders_for_service": "/", "contact_information_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/contact_information", "meta": {"desc": "Link contact information about this service"}}}, "value_to_customer": "Data replication  and safe storage  of your community data between geographically distributed centres", "user_customers_list": {"count": 0, "user_customers": []}, "description_internal": "\"B2SAFE is a robust, safe and highly available service which allows community and departmental repositories to implement data management policies on their research data across multiple administrative domains in a trustworthy manner.  \r\nabstraction layer of large scale, heterogeneous data storages\r\nguards against data loss in long-term archiving\r\nallows to optimize access for users (e.g. from different regions)\r\nbrings data closer to facilities for compute-intensive analysis\r\n\"", "request_procedures": "Joining the EUDAT CDI", "service_owner_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_owner", "meta": {"desc": "Service owner link"}}}, "name": "B2SAFE", "uuid": "88b35b0d-adc2-4a2e-b5fc-cae2d6f5456a", "service_details_list": {"count": 2, "service_details": [{"accounting_link": {"related": {"href": "", "meta": {"desc": "A link to the accounting system for this service."}}}, "version": "3.2", "monitoring_has": False, "service_status": "a", "features_current": "s", "decommissioning_procedure_has": False, "cost_to_run": "4", "operations_documentation_link": {"related": {"href": "", "meta": {"desc": "A link to the operations documentation for this service."}}}, "user_documentation_link": {"related": {"href": "", "meta": {"desc": "A link to the user documentation for this service."}}}, "service_details_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_details/3.2", "meta": {"desc": "Service details link"}}}, "accounting_has": False, "business_continuity_plan_link": {"related": {"href": "", "meta": {"desc": "A link to the business continuity plan for this service."}}}, "usage_policy_link": {"related": {"href": "", "meta": {"desc": "A link to the usage policy for this service."}}}, "operations_documentation_has": False, "monitoring_link": {"related": {"href": "", "meta": {"desc": "A link to the monitoring system for this service."}}}, "business_continuity_plan_has": False, "disaster_recovery_plan_url": {"related": {"href": "", "meta": {"desc": "A link to the disaster recovery plan for this service."}}}, "cost_to_build": "3", "use_cases": "d", "dependencies": {"count": 1, "services": [{"service_link": {"meta": {"desc": "A list of service dependencies"}, "related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2HANDLE"}}, "uuid": "9985c4ee-bef1-46d5-ae00-e501bfa7bdd0", "name": "B2HANDLE"}], "service_dependencies_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_dependencies", "meta": {"desc": "A list of links to the service dependencies"}}}}, "disaster_recovery_plan_has": False, "uuid": "80557cf5-cdb9-4dc5-b9d3-993008e054e3", "features_future": "s", "usage_policy_has": False, "user_documentation_has": False, "decommissioning_procedure_url": {"related": {"href": "", "meta": {"desc": "A link to the decommissioning procedure for this service."}}}}, {"accounting_link": {"related": {"href": "/", "meta": {"desc": "A link to the accounting system for this service."}}}, "version": "3.0", "monitoring_has": True, "service_status": "Active", "features_current": "\"Features:     - based on the execution of auditable data policy rules and the use of persistent identifiers (PIDs)    -  respects the rights of the data owners to define the access rights for their data and to decide how and when it is made publicly refe", "decommissioning_procedure_has": False, "cost_to_run": "Not specified", "operations_documentation_link": {"related": {"href": "", "meta": {"desc": "A link to the operations documentation for this service."}}}, "user_documentation_link": {"related": {"href": "http://eudat.eu/services/userdoc/configure-b2safe", "meta": {"desc": "A link to the user documentation for this service."}}}, "service_details_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_details/3.0", "meta": {"desc": "Service details link"}}}, "accounting_has": False, "business_continuity_plan_link": {"related": {"href": "/", "meta": {"desc": "A link to the business continuity plan for this service."}}}, "usage_policy_link": {"related": {"href": "/", "meta": {"desc": "A link to the usage policy for this service."}}}, "operations_documentation_has": False, "monitoring_link": {"related": {"href": "https://cmon.eudat.eu/nagvis_in_a_box.html", "meta": {"desc": "A link to the monitoring system for this service."}}}, "business_continuity_plan_has": False, "disaster_recovery_plan_url": {"related": {"href": "/", "meta": {"desc": "A link to the disaster recovery plan for this service."}}}, "cost_to_build": "Not specified", "use_cases": "", "dependencies": {"count": 1, "services": [{"service_link": {"meta": {"desc": "A list of service dependencies"}, "related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2HANDLE"}}, "uuid": "9985c4ee-bef1-46d5-ae00-e501bfa7bdd0", "name": "B2HANDLE"}], "service_dependencies_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_dependencies", "meta": {"desc": "A list of links to the service dependencies"}}}}, "disaster_recovery_plan_has": False, "uuid": "aa37cd70-c3e3-4334-a719-d467c22aed81", "features_future": "Futurs Features:                                                                                                                          - data policies are centrally managed via a Data Policy Manager, and the policy rules are implemented and enforced by", "usage_policy_has": False, "user_documentation_has": True, "decommissioning_procedure_url": {"related": {"href": "/", "meta": {"desc": "A link to the decommissioning procedure for this service."}}}}]}, "description_external": "\"B2SAFE is a robust, safe and highly available service which allows community and departmental repositories to implement data management policies on their research data across multiple administrative domains in a trustworthy manner.  \nabstraction layer of large scale, heterogeneous data storages\nguards against data loss in long-term archiving\nallows to optimize access for users (e.g. from different regions)\nbrings data closer to facilities for compute-intensive analysis\n\"", "service_area": "Data hosting & management", "service_complete_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE?view=complete", "meta": {"desc": "Portfolio level details about this service."}}}, "competitors": "/", "risks": "/"}
        data_complete = {"funders_for_service": "/", "uuid": "88b35b0d-adc2-4a2e-b5fc-cae2d6f5456a", "external": {"count": 1, "external_services": [{"uuid": "a42732fc-584e-429e-8df3-610caf2b1a50", "name": "First external"}], "external_services_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_external_dependencies", "meta": {"desc": "Links to external services that this service uses."}}}}, "description_external": "\"B2SAFE is a robust, safe and highly available service which allows community and departmental repositories to implement data management policies on their research data across multiple administrative domains in a trustworthy manner.  \nabstraction layer of large scale, heterogeneous data storages\nguards against data loss in long-term archiving\nallows to optimize access for users (e.g. from different regions)\nbrings data closer to facilities for compute-intensive analysis\n\"", "value_to_customer": "Data replication  and safe storage  of your community data between geographically distributed centres", "service_area": "Data hosting & management", "user_customers_list": {"count": 0, "user_customers": []}, "service_details_list": {"count": 2, "service_details": [{"accounting_link": {"related": {"href": "", "meta": {"desc": "A link to the accounting system for this service."}}}, "version": "3.2", "monitoring_has": False, "service_status": "a", "features_current": "s", "decommissioning_procedure_has": False, "cost_to_run": "4", "operations_documentation_link": {"related": {"href": "", "meta": {"desc": "A link to the operations documentation for this service."}}}, "user_documentation_link": {"related": {"href": "", "meta": {"desc": "A link to the user documentation for this service."}}}, "service_details_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_details/3.2", "meta": {"desc": "Service details link"}}}, "accounting_has": False, "business_continuity_plan_link": {"related": {"href": "", "meta": {"desc": "A link to the business continuity plan for this service."}}}, "usage_policy_link": {"related": {"href": "", "meta": {"desc": "A link to the usage policy for this service."}}}, "operations_documentation_has": False, "monitoring_link": {"related": {"href": "", "meta": {"desc": "A link to the monitoring system for this service."}}}, "business_continuity_plan_has": False, "disaster_recovery_plan_url": {"related": {"href": "", "meta": {"desc": "A link to the disaster recovery plan for this service."}}}, "cost_to_build": "3", "use_cases": "d", "dependencies": {"count": 1, "services": [{"service_link": {"meta": {"desc": "A list of service dependencies"}, "related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2HANDLE"}}, "uuid": "9985c4ee-bef1-46d5-ae00-e501bfa7bdd0", "name": "B2HANDLE"}], "service_dependencies_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_dependencies", "meta": {"desc": "A list of links to the service dependencies"}}}}, "disaster_recovery_plan_has": False, "uuid": "80557cf5-cdb9-4dc5-b9d3-993008e054e3", "features_future": "s", "usage_policy_has": False, "user_documentation_has": False, "decommissioning_procedure_url": {"related": {"href": "", "meta": {"desc": "A link to the decommissioning procedure for this service."}}}}, {"accounting_link": {"related": {"href": "/", "meta": {"desc": "A link to the accounting system for this service."}}}, "version": "3.0", "monitoring_has": True, "service_status": "Active", "features_current": "\"Features:     - based on the execution of auditable data policy rules and the use of persistent identifiers (PIDs)    -  respects the rights of the data owners to define the access rights for their data and to decide how and when it is made publicly refe", "decommissioning_procedure_has": False, "cost_to_run": "Not specified", "operations_documentation_link": {"related": {"href": "", "meta": {"desc": "A link to the operations documentation for this service."}}}, "user_documentation_link": {"related": {"href": "http://eudat.eu/services/userdoc/configure-b2safe", "meta": {"desc": "A link to the user documentation for this service."}}}, "service_details_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_details/3.0", "meta": {"desc": "Service details link"}}}, "accounting_has": False, "business_continuity_plan_link": {"related": {"href": "/", "meta": {"desc": "A link to the business continuity plan for this service."}}}, "usage_policy_link": {"related": {"href": "/", "meta": {"desc": "A link to the usage policy for this service."}}}, "operations_documentation_has": False, "monitoring_link": {"related": {"href": "https://cmon.eudat.eu/nagvis_in_a_box.html", "meta": {"desc": "A link to the monitoring system for this service."}}}, "business_continuity_plan_has": False, "disaster_recovery_plan_url": {"related": {"href": "/", "meta": {"desc": "A link to the disaster recovery plan for this service."}}}, "cost_to_build": "Not specified", "use_cases": "", "dependencies": {"count": 1, "services": [{"service_link": {"meta": {"desc": "A list of service dependencies"}, "related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2HANDLE"}}, "uuid": "9985c4ee-bef1-46d5-ae00-e501bfa7bdd0", "name": "B2HANDLE"}], "service_dependencies_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_dependencies", "meta": {"desc": "A list of links to the service dependencies"}}}}, "disaster_recovery_plan_has": False, "uuid": "aa37cd70-c3e3-4334-a719-d467c22aed81", "features_future": "Futurs Features:                                                                                                                          - data policies are centrally managed via a Data Policy Manager, and the policy rules are implemented and enforced by", "usage_policy_has": False, "user_documentation_has": True, "decommissioning_procedure_url": {"related": {"href": "/", "meta": {"desc": "A link to the decommissioning procedure for this service."}}}}]}, "competitors": "/", "dependencies": {"count": 1, "services": [{"service_link": {"meta": {"desc": "A list of service dependencies"}, "related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2HANDLE"}}, "uuid": "9985c4ee-bef1-46d5-ae00-e501bfa7bdd0", "name": "B2HANDLE"}], "service_dependencies_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_dependencies", "meta": {"desc": "A list of links to the service dependencies"}}}}, "risks": "/", "description_internal": "\"B2SAFE is a robust, safe and highly available service which allows community and departmental repositories to implement data management policies on their research data across multiple administrative domains in a trustworthy manner.  \r\nabstraction layer of large scale, heterogeneous data storages\r\nguards against data loss in long-term archiving\r\nallows to optimize access for users (e.g. from different regions)\r\nbrings data closer to facilities for compute-intensive analysis\r\n\"", "request_procedures": "Joining the EUDAT CDI", "contact_information_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/contact_information", "meta": {"desc": "Link contact information about this service"}}}, "service_owner_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_owner", "meta": {"desc": "Service owner link"}}}, "name": "B2SAFE"}

        expected_response_short = helper.get_response_info(strings.SERVICE_INFORMATION, data_short)
        expected_response_complete = helper.get_response_info(strings.SERVICE_INFORMATION, data_complete)

        self.assertJSONEqual(json.dumps(expected_response_short), response_short.content)
        # self.assertJSONEqual(json.dumps(expected_response_complete), response_complete.content)

    def test_get_all_service_details(self):
        response = self.client_stub.get('/api/v1/portfolio/services/B2SAFE/service_details/')
        data = {"count": 2, "service_details": [{"features_future": "s", "uuid": "80557cf5-cdb9-4dc5-b9d3-993008e054e3", "service_details_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_details/3.2", "meta": {"desc": "Service details access url."}}}, "version": "3.2", "service_status": "a", "features_current": "s"}, {"features_future": "Futurs Features:                                                                                                                          - data policies are centrally managed via a Data Policy Manager, and the policy rules are implemented and enforced by", "uuid": "aa37cd70-c3e3-4334-a719-d467c22aed81", "service_details_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2SAFE/service_details/3.0", "meta": {"desc": "Service details access url."}}}, "version": "3.0", "service_status": "Active", "features_current": "\"Features:     - based on the execution of auditable data policy rules and the use of persistent identifiers (PIDs)    -  respects the rights of the data owners to define the access rights for their data and to decide how and when it is made publicly refe"}]}
        expected_response = helper.get_response_info(strings.SERVICE_DETAIL_INFORMATION, data)
        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_get_all_service_details_empty(self):
        response = self.client_stub.get('/api/v1/portfolio/services/7d829471-4904-4da9-a831-c72f6b1c747e/service_details/')
        data = {"count": 0, "service_details": []}
        expected_response = helper.get_response_info(strings.SERVICE_DETAIL_INFORMATION, data)
        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_get_service_details_invalid_version(self):
        response = self.client_stub.get('/api/v1/portfolio/services/f6148f39-4951-4915-87d7-5c6ce47aa79F/service_details/0.2')
        expected_response = helper.get_error_response(strings.SERVICE_DETAILS_NOT_FOUND)
        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_get_service_details(self):
        response = self.client_stub.get('/api/v1/portfolio/services/f6148f39-4951-4915-87d7-5c6ce47aa79F/service_details/0.1')
        data = {"accounting_link": {"related": {"href": "/", "meta": {"desc": "A link to the accounting system for this service."}}}, "version": "0.1", "monitoring_has": False, "service_status": "Planned", "service_options_list": {"count": 1, "service_options": [{"pricing": "Not specified yet", "SLA_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/EUDAT_Service_Portfolio_Management_System/service_details/0.1/service_options/sla/2ad2b14a-0874-44af-94be-e00093fc3e3c", "meta": {"desc": "A link to the SLA for this service."}}}, "description": "Standard options", "uuid": "61c31958-412f-43cf-be19-1f59ea89d0ee", "name": "Standard"}], "service_options_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/EUDAT_Service_Portfolio_Management_System/service_details/0.1/service_options", "meta": {"desc": "Link to the service options"}}}}, "features_current": "Under development", "decommissioning_procedure_has": False, "cost_to_run": "Not speficied yet", "operations_documentation_link": {"related": {"href": "", "meta": {"desc": "A link to the operations documentation for this service."}}}, "user_documentation_link": {"related": {"href": "/", "meta": {"desc": "A link to the user documentation for this service."}}}, "accounting_has": False, "business_continuity_plan_link": {"related": {"href": "/", "meta": {"desc": "A link to the business continuity plan for this service."}}}, "usage_policy_link": {"related": {"href": "/", "meta": {"desc": "A link to the usage policy for this service."}}}, "operations_documentation_has": False, "monitoring_link": {"related": {"href": "/", "meta": {"desc": "A link to the monitoring system for this service."}}}, "business_continuity_plan_has": False, "disaster_recovery_plan_url": {"related": {"href": "/", "meta": {"desc": "A link to the disaster recovery plan for this service."}}}, "cost_to_build": "6PMs to cover EUDAT's requirements", "use_cases": "", "dependencies": {"count": 0, "services": [], "service_dependencies_link": {"related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/EUDAT_Service_Portfolio_Management_System/service_dependencies", "meta": {"desc": "A list of links to the service dependencies"}}}}, "disaster_recovery_plan_has": False, "uuid": "a2c9c5e8-8df2-4f52-8e16-c0f57db86420", "features_future": "\"CRUD access to the service portfolio database RESTful API (JSON) provision Read only GUI to the service catalogue/portfolio Role Management and Authentication GUI for inserting information to the portfolio\"", "usage_policy_has": False, "user_documentation_has": False, "components": {"components": "This service has no service components."}, "decommissioning_procedure_url": {"related": {"href": "/", "meta": {"desc": "A link to the decommissioning procedure for this service."}}}}
        expected_response = helper.get_response_info(strings.SERVICE_DETAIL_INFORMATION, data)
        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_service_dependencies_empty(self):
        response = self.client_stub.get('/api/v1/portfolio/services/583ec8f2-9ef6-4e51-89bd-9af7f5fcea9c/service_dependencies')
        data = {"count": 0, "dependencies": []}
        expected_response = helper.get_response_info(strings.SERVICE_DEPENDENCIES_INFORMATION, data)
        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_service_dependencies(self):
        response = self.client_stub.get('/api/v1/portfolio/services/B2SAFE/service_dependencies')
        data = {"count": 1, "dependencies": [{"service_link": {"meta": {"desc": "A list of service dependencies"}, "related": {"href": "http://agora-dev.aris.grnet.gr/api/v1/portfolio/services/B2HANDLE"}}, "uuid": "9985c4ee-bef1-46d5-ae00-e501bfa7bdd0", "name": "B2HANDLE"}]}
        expected_response = helper.get_response_info(strings.SERVICE_DEPENDENCIES_INFORMATION, data)
        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_external_service_dependencies_empty(self):
        response = self.client_stub.get('/api/v1/portfolio/services/B2HANDLE/service_external_dependencies')
        data = {"count": 0, "dependencies": []}
        expected_response = helper.get_response_info(strings.SERVICE_EXTERNAL_DEPENDENCIES_INFORMATION, data)
        self.assertJSONEqual(json.dumps(expected_response), response.content)

    def test_external_service_dependencies(self):
        response = self.client_stub.get('/api/v1/portfolio/services/B2SAFE/service_external_dependencies')
        data = {"count": 1, "dependencies": [{"details": "details", "description": "Something", "id": "a42732fc-584e-429e-8df3-610caf2b1a50", "service": "Service one", "name": "First external"}]}
        expected_response = helper.get_response_info(strings.SERVICE_EXTERNAL_DEPENDENCIES_INFORMATION, data)
        self.assertJSONEqual(json.dumps(expected_response), response.content)
























